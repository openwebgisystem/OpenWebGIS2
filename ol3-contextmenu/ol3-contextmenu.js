/**
 * Custom Context Menu for Openlayers 3
 * https://github.com/jonataswalker/ol3-contextmenu
 * Version: v2.3.0
 * Built: 2016-10-06T17:47:50-03:00
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ContextMenu=t()}(this,function(){"use strict";var e="ol-ctx-menu",t="-container",n="-separator",i="-submenu",s="-hidden",o="-icon",a="-zoom-in",r="-zoom-out",l="ol-unselectable",c={BEFOREOPEN:"beforeopen",OPEN:"open",CLOSE:"close",ADD_MENU_ENTRY:"add-menu-entry",CONTEXTMENU:"contextmenu",HOVER:"mouseover"},u={container:e+t,separator:e+n,submenu:e+i,hidden:e+s,icon:e+o,zoomIn:e+a,zoomOut:e+r,OL_unselectable:l},d={width:150,eventType:c.CONTEXTMENU,defaultItems:!0},h=[{text:"Zoom In",classname:[u.zoomIn,u.icon].join(" "),callback:function(e,t){var n=t.getView(),i=ol.animation.pan({duration:1e3,source:n.getCenter()}),s=ol.animation.zoom({duration:1e3,resolution:n.getResolution()});t.beforeRender(i,s),n.setCenter(e.coordinate),n.setZoom(+n.getZoom()+1)}},{text:"Zoom Out",classname:[u.zoomOut,u.icon].join(" "),callback:function(e,t){var n=t.getView(),i=ol.animation.pan({duration:1e3,source:n.getCenter()}),s=ol.animation.zoom({duration:1e3,resolution:n.getResolution()});t.beforeRender(i,s),n.setCenter(e.coordinate),n.setZoom(+n.getZoom()-1)}}],m={isNumeric:function(e){return/^\d+$/.test(e)},classRegex:function(e){return new RegExp("(^|\\s+) "+e+" (\\s+|$)")},addClass:function(e,t,n){var i=this;if(Array.isArray(e))return void e.forEach(function(e){i.addClass(e,t)});for(var s=Array.isArray(t)?t:t.split(/\s+/),o=s.length;o--;)i.hasClass(e,s[o])||i._addClass(e,s[o],n)},_addClass:function(e,t,n){var i=this;e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._removeClass(e,t)},n)},removeClass:function(e,t,n){var i=this;if(Array.isArray(e))return void e.forEach(function(e){i.removeClass(e,t,n)});for(var s=Array.isArray(t)?t:t.split(/\s+/),o=s.length;o--;)i.hasClass(e,s[o])&&i._removeClass(e,s[o],n)},_removeClass:function(e,t,n){var i=this;e.classList?e.classList.remove(t):e.className=e.className.replace(this.classRegex(t)," ").trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._addClass(e,t)},n)},hasClass:function(e,t){return e.classList?e.classList.contains(t):this.classRegex(t).test(e.className)},toggleClass:function(e,t){var n=this;return Array.isArray(e)?void e.forEach(function(e){n.toggleClass(e,t)}):void(e.classList?e.classList.toggle(t):this.hasClass(e,t)?this._removeClass(e,t):this._addClass(e,t))},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},find:function(e,t,n){void 0===t&&(t=window.document);var i=/^(#?[\w-]+|\.[\w-.]+)$/,s=/\./g,o=Array.prototype.slice,a=[];if(i.test(e))switch(e[0]){case"#":a=[this.$(e.substr(1))];break;case".":a=o.call(t.getElementsByClassName(e.substr(1).replace(s," ")));break;default:a=o.call(t.getElementsByTagName(e))}else a=o.call(t.querySelectorAll(e));return n?a:a[0]},offset:function(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+window.pageXOffset-n.clientLeft,top:t.top+window.pageYOffset-n.clientTop,width:e.offsetWidth,height:e.offsetHeight}},getViewportSize:function(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},isEmpty:function(e){return!e||0===e.length},emptyArray:function(e){for(;e.length;)e.pop()},removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},mergeOptions:function(e,t){var n={};for(var i in e)n[i]=e[i];for(var s in t)n[s]=t[s];return n},createFragment:function(e){var t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.firstChild);return t},contains:function(e,t){return!!~t.indexOf(e)},isDefAndNotNull:function(e){return null!=e},assertEqual:function(e,t,n){if(e!==t)throw new Error(n+" mismatch: "+e+" != "+t)},assert:function(e,t){if(void 0===t&&(t="Assertion failed"),!e){if("undefined"!=typeof Error)throw new Error(t);throw t}}},p=function(e){return this.Base=e,this.map=void 0,this.map_element=void 0,this.coordinate_clicked=void 0,this.pixel_clicked=void 0,this.counter=0,this.lineHeight=0,this.items={},this.opened=!1,this.submenu={left:this.Base.options.width-15+"px",last_left:""},this.eventHandler=this.handleEvent.bind(this),this};p.prototype.init=function(e){this.map=e,this.map_element=e.getTargetElement(),this.setListeners(),this.Base.constructor.Html.createMenu(),this.lineHeight=this.getItemsLength()>0?this.Base.container.offsetHeight/this.getItemsLength():this.Base.constructor.Html.cloneAndGetLineHeight()},p.prototype.getItemsLength=function(){var e=this,t=0;return Object.keys(this.items).forEach(function(n){e.items[n].submenu||e.items[n].separator||t++}),t},p.prototype.getPixelClicked=function(){return this.pixel_clicked},p.prototype.getCoordinateClicked=function(){return this.coordinate_clicked},p.prototype.positionContainer=function(e){var t=this,n=this.map.getSize(),i=n[0],s=n[1],o=s-e[1],a=i-e[0],r={w:this.Base.container.offsetWidth,h:Math.round(this.lineHeight*this.getItemsLength())},l=m.find("li."+u.submenu+">ul",this.Base.container,!0);a>=r.w?(this.Base.container.style.right="auto",this.Base.container.style.left=e[0]+5+"px"):(this.Base.container.style.left="auto",this.Base.container.style.right="15px"),o>=r.h?(this.Base.container.style.bottom="auto",this.Base.container.style.top=e[1]-10+"px"):(this.Base.container.style.top="auto",this.Base.container.style.bottom=0),m.removeClass(this.Base.container,u.hidden),l.length&&(a<2*r.w?this.submenu.last_left="-"+r.w+"px":this.submenu.last_left=this.submenu.left,l.forEach(function(e){var n=m.getViewportSize(),i=m.offset(e),s=i.height,a=o-s;a<0&&(a=s-(n.h-i.top),e.style.top="-"+a+"px"),e.style.left=t.submenu.last_left}))},p.prototype.openMenu=function(e,t){this.Base.dispatchEvent({type:c.OPEN,pixel:e,coordinate:t}),this.opened=!0,this.positionContainer(e)},p.prototype.closeMenu=function(){this.opened=!1,m.addClass(this.Base.container,u.hidden),this.Base.dispatchEvent({type:c.CLOSE})},p.prototype.getNextItemIndex=function(){return++this.counter},p.prototype.setListeners=function(){this.map_element.addEventListener(this.Base.options.eventType,this.eventHandler,!1)},p.prototype.removeListeners=function(){this.map_element.removeEventListener(this.Base.options.eventType,this.eventHandler,!1)},p.prototype.handleEvent=function(e){var t=this;t.coordinate_clicked=this.map.getEventCoordinate(e),t.pixel_clicked=this.map.getEventPixel(e),t.Base.dispatchEvent({type:c.BEFOREOPEN,pixel:t.pixel_clicked,coordinate:t.coordinate_clicked}),t.Base.disabled||(this.Base.options.eventType===c.CONTEXTMENU&&(e.stopPropagation(),e.preventDefault()),t.openMenu(t.pixel_clicked,t.coordinate_clicked),e.target.addEventListener("mousedown",{handleEvent:function(n){t.closeMenu(),e.target.removeEventListener(n.type,this,!1)}},!1))},p.prototype.setItemListener=function(e,t){var n=this;e&&"function"==typeof this.items[t].callback&&!function(i){e.addEventListener("click",function(e){e.preventDefault();var s={coordinate:n.getCoordinateClicked(),data:n.items[t].data||null};n.closeMenu(),i(s,n.map)},!1)}(this.items[t].callback)};var f=function(e){return this.Base=e,this.Base.container=this.container=this.createContainer(),this};f.prototype.createContainer=function(){var e=document.createElement("ul");return e.className=[u.container,u.hidden,u.OL_unselectable].join(" "),e.style.width=parseInt(this.Base.options.width,10)+"px",e},f.prototype.createMenu=function(){var e=this.Base.options,t=[];return"items"in e?t=e.defaultItems?e.items.concat(h):e.items:e.defaultItems&&(t=h),0!==t.length&&void t.forEach(this.addMenuEntry,this)},f.prototype.addMenuEntry=function(e){var t=this,n=this.Base.constructor.Internal,i=n.getNextItemIndex();if(e.items&&Array.isArray(e.items)){e.classname=e.classname||"",m.contains(u.submenu,e.classname)||(e.classname=e.classname.length>0?" "+u.submenu:u.submenu);var s=this.generateHtmlAndPublish(this.container,e,i),o=document.createElement("ul");o.className=u.container,o.style.left=n.submenu.last_left||n.submenu.left,o.style.width=this.Base.options.width+"px",s.appendChild(o),e.items.forEach(function(e){t.generateHtmlAndPublish(o,e,n.getNextItemIndex(),!0)})}else this.generateHtmlAndPublish(this.container,e,i)},f.prototype.generateHtmlAndPublish=function(e,t,n,i){var s,o,a,r=!1,l=this.Base.constructor.Internal;return"string"==typeof t&&"-"===t.trim()?(s=['<li id="index',n,'" class="',u.separator,'"><hr></li>'].join(""),o=m.createFragment(s),a=[].slice.call(o.childNodes,0)[0],e.appendChild(o),r=!0):(t.classname=t.classname||"",s="<span>"+t.text+"</span>",o=m.createFragment(s),a=document.createElement("li"),t.icon&&(""===t.classname?t.classname=u.icon:t.classname.indexOf(u.icon)===-1&&(t.classname+=" "+u.icon),a.setAttribute("style","background-image:url("+t.icon+")")),a.id="index"+n,a.className=t.classname,a.appendChild(o),e.appendChild(a)),l.items[n]={id:n,submenu:i||0,separator:r,callback:t.callback,data:t.data||null},l.setItemListener(a,n),a},f.prototype.removeMenuEntry=function(e){var t=m.find("#index"+e,this.container);t&&this.container.removeChild(t),delete this.Base.constructor.Internal.items[e]},f.prototype.cloneAndGetLineHeight=function(){var e=this.container.cloneNode(),t=m.createFragment("<span>Foo</span>"),n=m.createFragment("<span>Foo</span>"),i=document.createElement("li"),s=document.createElement("li");i.appendChild(t),s.appendChild(n),e.appendChild(i),e.appendChild(s),this.container.parentNode.appendChild(e);var o=e.offsetHeight/2;return this.container.parentNode.removeChild(e),o};var y=function(e){function t(n){void 0===n&&(n={}),m.assert("object"==typeof n,"@param `opt_options` should be object type!"),"default_items"in n&&(d.defaultItems=n.default_items),this.options=m.mergeOptions(d,n),this.disabled=!1,t.Internal=new p(this),t.Html=new f(this),e.call(this,{element:this.container})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.clear=function(){Object.keys(t.Internal.items).forEach(function(e){t.Html.removeMenuEntry(e)})},t.prototype.close=function(){t.Internal.closeMenu()},t.prototype.enable=function(){this.disabled=!1},t.prototype.disable=function(){this.disabled=!0},t.prototype.getDefaultItems=function(){return h},t.prototype.extend=function(e){m.assert(Array.isArray(e),"@param `arr` should be an Array."),e.forEach(this.push,this)},t.prototype.isOpened=function(){return t.Internal.opened},t.prototype.pop=function(){var e=Object.keys(t.Internal.items);t.Html.removeMenuEntry(e[e.length-1])},t.prototype.push=function(e){m.assert(m.isDefAndNotNull(e),"@param `item` must be informed."),t.Html.addMenuEntry(e,t.Internal.getNextItemIndex())},t.prototype.shift=function(){t.Html.removeMenuEntry(Object.keys(t.Internal.items)[0])},t.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e),e?t.Internal.init(e):t.Internal.removeListeners()},t}(ol.control.Control);return y});
